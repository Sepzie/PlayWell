// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
  output   = "../node_modules/.prisma/client"
  binaryTargets = ["native"]
}

datasource db {
  provider = "sqlite"
  url = "file:./main.db"
  // url      = env("DATABASE_URL")
  relationMode = "prisma"
}


model User {
  id Int @id @default(autoincrement()) 
  username String    @unique
  ownedGames Game[]  @relation("OwnedGames") // fk
  doneSessions GamingSession[] @relation("SessionsDone") // fk
  limits     Limit[] @relation("Limits")
  notificationPreferences NotificationPreferences?
}

model Game {
  id        String   @id @default(cuid())
  name      String   @unique
  
  // FK
  owner     User     @relation("OwnedGames", fields: [userId], references: [id], onDelete: Cascade)
  userId    Int
  
  location  String
  platform  String
  enabled   Boolean  @default(true)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  partOfSessions GamingSession[] @relation("PartOfSessions") // fk
}

// GamingSession of User
model GamingSession {
  id        String   @id @default(cuid())

  // FK
  sessionOwner User  @relation("SessionsDone", fields: [userId], references: [id], onDelete: Cascade)
  userId    Int

  // FK
  gamePlayed Game @relation("PartOfSessions", fields: [gameId], references: [id], onDelete: Cascade)
  gameId    String

  startTime DateTime @default(now())
  endTime   DateTime @updatedAt
  durationSeconds  Int?
}

enum DayOfWeek {
  SUNDAY
  MONDAY
  TUESDAY
  WEDNESDAY
  THURSDAY
  FRIDAY
  SATURDAY
}

model Limit {
  id        Int      @id @default(autoincrement())

  // FK
  owner     User     @relation("Limits", fields: [userId], references: [id], onDelete: Cascade)
  userId    Int

  type      DayOfWeek
  limitSeconds  Int  @default(3600)

  @@unique([userId, type])
}

model NotificationPreferences {
  id        Int      @id @default(autoincrement())

  // FK
  owner     User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  userId    Int      @unique

  newGameDetected Boolean @default(true)
  gameStarted     Boolean @default(true)
  gameStopped     Boolean @default(true)
  stopTrackingOnUnfocus Boolean @default(false)
}

